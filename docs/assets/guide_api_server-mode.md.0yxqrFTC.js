import{_ as i,o as a,c as e,ah as n}from"./chunks/framework.Zhm0w2YF.js";const c=JSON.parse('{"title":"服务端模式 (Swoole)","description":"","frontmatter":{},"headers":[],"relativePath":"guide/api/server-mode.md","filePath":"guide/api/server-mode.md","lastUpdated":1770070015000}'),l={name:"guide/api/server-mode.md"};function t(h,s,p,k,r,o){return a(),e("div",null,[...s[0]||(s[0]=[n(`<h1 id="服务端模式-swoole" tabindex="-1">服务端模式 (Swoole) <a class="header-anchor" href="#服务端模式-swoole" aria-label="Permalink to &quot;服务端模式 (Swoole)&quot;">​</a></h1><p>Anon Framework 内置了基于 Swoole 的服务端模式，支持 HTTP、TCP、WebSocket 等高性能服务，以及进程管理和定时任务功能。</p><div class="warning custom-block"><p class="custom-block-title">注意</p><p>服务端模式依赖 <a href="https://www.swoole.com/" target="_blank" rel="noreferrer">Swoole</a> 扩展。请确保你的 PHP 环境（仅限 Linux/macOS）已安装并启用 Swoole 扩展。Windows 环境下暂不支持（可使用 WSL 或 Docker）。</p></div><h2 id="快速开始" tabindex="-1">快速开始 <a class="header-anchor" href="#快速开始" aria-label="Permalink to &quot;快速开始&quot;">​</a></h2><p>所有的服务启动都通过统一的命令行入口 <code>index.php</code> 进行管理。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 基本语法</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server/index.php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> swoole</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [服务类型] [操作] [选项]</span></span></code></pre></div><h3 id="参数说明" tabindex="-1">参数说明 <a class="header-anchor" href="#参数说明" aria-label="Permalink to &quot;参数说明&quot;">​</a></h3><ul><li><strong>服务类型</strong>: <ul><li><code>http</code>: 启动 HTTP 服务器 (默认)</li><li><code>tcp</code>: 启动 TCP 服务器</li><li><code>websocket</code>: 启动 WebSocket 服务器</li></ul></li><li><strong>操作</strong>: <ul><li><code>start</code>: 启动服务</li><li><code>stop</code>: 停止服务</li><li><code>reload</code>: 重载服务</li></ul></li><li><strong>选项</strong>: <ul><li><code>--port=端口号</code>: 指定监听端口</li><li><code>--host=主机名</code>: 指定监听地址 (默认 0.0.0.0)</li></ul></li></ul><h2 id="http-服务" tabindex="-1">HTTP 服务 <a class="header-anchor" href="#http-服务" aria-label="Permalink to &quot;HTTP 服务&quot;">​</a></h2><p>基于 Swoole 的高性能 HTTP 服务器，可以替代 Nginx+PHP-FPM 的传统架构。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动 HTTP 服务 (默认端口 9501)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server/index.php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> swoole</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 指定端口启动</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server/index.php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> swoole</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --port=8080</span></span></code></pre></div><h3 id="框架集成" tabindex="-1">框架集成 <a class="header-anchor" href="#框架集成" aria-label="Permalink to &quot;框架集成&quot;">​</a></h3><p>HTTP 服务已通过输出缓冲 (Output Buffering) 技术与 Anon Framework 核心集成。</p><ul><li>请求参数 (<code>$_GET</code>, <code>$_POST</code>, <code>$_SERVER</code> 等) 会自动从 Swoole 请求对象中注入。</li><li>框架的响应输出会被捕获并返回给客户端。</li></ul><h2 id="tcp-服务" tabindex="-1">TCP 服务 <a class="header-anchor" href="#tcp-服务" aria-label="Permalink to &quot;TCP 服务&quot;">​</a></h2><p>提供基础的 TCP 通信服务。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动 TCP 服务 (默认端口 9502)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server/index.php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> swoole</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span></span></code></pre></div><h3 id="交互示例" tabindex="-1">交互示例 <a class="header-anchor" href="#交互示例" aria-label="Permalink to &quot;交互示例&quot;">​</a></h3><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 连接成功</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">客户端</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">连接成功。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 发送数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">服务端</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">您发送的数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 连接断开</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">客户端</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">连接关闭。</span></span></code></pre></div><h2 id="websocket-服务" tabindex="-1">WebSocket 服务 <a class="header-anchor" href="#websocket-服务" aria-label="Permalink to &quot;WebSocket 服务&quot;">​</a></h2><p>提供全双工 WebSocket 通信服务。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动 WebSocket 服务 (默认端口 9503)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server/index.php</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> swoole</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> websocket</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span></span></code></pre></div><h3 id="交互逻辑" tabindex="-1">交互逻辑 <a class="header-anchor" href="#交互逻辑" aria-label="Permalink to &quot;交互逻辑&quot;">​</a></h3><ul><li><strong>Open</strong>: 连接建立时会在控制台输出 <code>WebSocket 连接开启: {fd}</code>。</li><li><strong>Message</strong>: 收到消息时会回复 <code>服务端已收到: {消息内容}</code>。</li><li><strong>Close</strong>: 连接关闭时输出日志。</li></ul><h2 id="高级功能" tabindex="-1">高级功能 <a class="header-anchor" href="#高级功能" aria-label="Permalink to &quot;高级功能&quot;">​</a></h2><h3 id="进程管理-process" tabindex="-1">进程管理 (Process) <a class="header-anchor" href="#进程管理-process" aria-label="Permalink to &quot;进程管理 (Process)&quot;">​</a></h3><p>模块内部封装了 <code>Swoole\\Process</code>，支持创建和管理自定义子进程。</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用示例 (在自定义代码中)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$manager </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Anon_Server_Driver_Swoole_Process</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$manager</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($process) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 执行后台任务</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$manager</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h3 id="定时任务-crontab" tabindex="-1">定时任务 (Crontab) <a class="header-anchor" href="#定时任务-crontab" aria-label="Permalink to &quot;定时任务 (Crontab)&quot;">​</a></h3><p>模块内部封装了 <code>Swoole\\Timer</code>，支持毫秒级定时任务。</p><div class="language-php vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用示例</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$crontab </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Anon_Server_Driver_Swoole_Crontab</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 每秒执行一次</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$crontab</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;定时任务执行中...</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$crontab</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><h2 id="部署建议" tabindex="-1">部署建议 <a class="header-anchor" href="#部署建议" aria-label="Permalink to &quot;部署建议&quot;">​</a></h2><ol><li><strong>守护进程</strong>: 生产环境建议结合 <code>Supervisor</code> 或 <code>Systemd</code> 管理服务进程。</li><li><strong>反向代理</strong>: 建议在 Swoole 服务前部署 Nginx 作为反向代理，处理静态资源和 SSL 终端。</li><li><strong>开发环境</strong>: Windows 用户请使用 WSL2 或 Docker 容器进行开发调试。</li></ol>`,33)])])}const g=i(l,[["render",t]]);export{c as __pageData,g as default};
