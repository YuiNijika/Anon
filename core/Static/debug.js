(()=>{var I={setup(){let{ref:t,reactive:w,onMounted:v}=Vue,s=t("overview"),u=t(!1),i=t(!1),d=t(null),r=w({performance:null,logs:null,errors:null,hooks:null}),f=[{id:"overview",label:"\u7CFB\u7EDF\u6982\u89C8"},{id:"performance",label:"\u6027\u80FD\u76D1\u63A7"},{id:"logs",label:"\u7CFB\u7EDF\u65E5\u5FD7"},{id:"errors",label:"\u9519\u8BEF\u65E5\u5FD7"},{id:"hooks",label:"Hook\u8C03\u8BD5"},{id:"tools",label:"\u8C03\u8BD5\u5DE5\u5177"}],p=async()=>{try{let a=await(await fetch("/auth/token",{credentials:"include"})).json();if(a.code===200&&a.data?.token)return localStorage.setItem("token",a.data.token),a.data.token}catch(e){console.debug("\u83B7\u53D6 Token \u5931\u8D25:",e)}return null},g=async()=>{try{let e=localStorage.getItem("token");e||(e=await p());let a={};e&&(a["X-API-Token"]=e);let c=await(await fetch("/user/info",{credentials:"include",headers:a})).json();c.code===200&&c.data?(d.value=c.data,c.data.token?localStorage.setItem("token",c.data.token):!e&&c.code===200&&(e=await p())):window.location.href="/anon/debug/login"}catch(e){console.error("\u68C0\u67E5\u767B\u5F55\u72B6\u6001\u5931\u8D25:",e),window.location.href="/anon/debug/login"}},y=e=>{s.value=e,e!=="overview"&&!r[e]&&o(e)},o=async e=>{i.value=!0;try{let a={"Content-Type":"application/json"},h=localStorage.getItem("token");h&&(a["X-API-Token"]=h);let m=await(await fetch(`/anon/debug/api/${e}`,{credentials:"include",headers:a})).json();m.code===200&&m.data?r[e]=m.data:console.error("\u52A0\u8F7D\u6570\u636E\u5931\u8D25:",m.message)}catch(a){console.error("\u7F51\u7EDC\u9519\u8BEF:",a)}finally{i.value=!1}},n=()=>{let e=s.value;e!=="overview"?(r[e]=null,o(e)):window.location.reload()},l=async()=>{if(confirm("\u786E\u5B9A\u8981\u6E05\u7406\u8C03\u8BD5\u6570\u636E\u5417\uFF1F"))try{let e={"Content-Type":"application/json"},a=localStorage.getItem("token");a&&(e["X-API-Token"]=a);let c=await(await fetch("/anon/debug/api/clear",{method:"POST",credentials:"include",headers:e})).json();c.code===200?(alert("\u8C03\u8BD5\u6570\u636E\u5DF2\u6E05\u7406"),n()):alert("\u6E05\u7406\u5931\u8D25: "+c.message)}catch(e){alert("\u7F51\u7EDC\u9519\u8BEF: "+e.message)}},k=()=>{window.open("/anon/debug/api/info","_blank")},b=()=>{confirm("\u786E\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u8C03\u8BD5\u6570\u636E\u5417\uFF1F\u6B64\u64CD\u4F5C\u4E0D\u53EF\u6062\u590D\uFF01")&&l()},S=async()=>{try{await fetch("/auth/logout",{method:"POST",credentials:"include"}),localStorage.removeItem("token"),window.location.href="/anon/debug/login"}catch(e){console.error("\u9000\u51FA\u5931\u8D25:",e),localStorage.removeItem("token"),window.location.href="/anon/debug/login"}};return v(()=>{g()}),{activeSection:s,loading:u,sectionLoading:i,userInfo:d,sectionData:r,navItems:f,switchSection:y,refreshData:n,clearDebugData:l,exportDebugData:k,clearAllData:b,handleLogout:S}}},P={setup(){let{ref:t,reactive:w,onMounted:v}=Vue,s=w({username:"",password:"",captcha:""}),u=t(!1),i=t(""),d=t(""),r=t(!1),f=t(""),p=async()=>{try{let n=await(await fetch("/anon/common/config")).json();n.code===200&&n.data?.captcha!==void 0&&(r.value=n.data.captcha,r.value&&g())}catch(o){console.error("\u68C0\u67E5\u9A8C\u8BC1\u7801\u914D\u7F6E\u5931\u8D25:",o)}},g=async()=>{try{let n=await(await fetch("/auth/captcha")).json();n.code===200&&n.data?.image&&(f.value=n.data.image,s.captcha="")}catch(o){i.value="\u83B7\u53D6\u9A8C\u8BC1\u7801\u5931\u8D25: "+o.message}},y=async()=>{u.value=!0,i.value="",d.value="";try{let o={username:s.username,password:s.password};r.value&&(o.captcha=s.captcha);let l=await(await fetch("/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(o)})).json();l.code===200?(l.data?.token&&localStorage.setItem("token",l.data.token),d.value="\u767B\u5F55\u6210\u529F\uFF0C\u6B63\u5728\u8DF3\u8F6C...",setTimeout(()=>{window.location.href="/anon/debug/console"},500)):(i.value=l.message||"\u767B\u5F55\u5931\u8D25",r.value&&(l.message?.includes("\u9A8C\u8BC1\u7801")||l.message?.includes("captcha"))&&(s.captcha="",g()))}catch(o){i.value="\u7F51\u7EDC\u9519\u8BEF: "+o.message}finally{u.value=!1}};return v(()=>{p()}),{form:s,loading:u,error:i,success:d,captchaEnabled:r,captchaImage:f,refreshCaptcha:g,handleLogin:y}}};typeof window<"u"&&(window.DebugConsole=I,window.DebugLogin=P);})();
