(()=>{window.InstallApp={setup(){let{ref:o,computed:f,h:e,onMounted:x}=Vue,u=o("mode"),c=o("api"),s=o(""),i=o(""),t=o(!1),d=o(""),p=o([]),r=o({db_host:"localhost",db_port:3306,db_user:"root",db_pass:"",db_name:"",db_prefix:"anon_"}),n=o({username:"admin",email:"",password:"",site_title:"",site_description:""}),m=f(()=>{let a=n.value.password;if(!a)return 0;let l=0;return a.length>=8&&(l+=20),a.length>=12&&(l+=20),/[A-Z]/.test(a)&&(l+=20),/[0-9]/.test(a)&&(l+=20),/[^A-Za-z0-9]/.test(a)&&(l+=20),l}),g=f(()=>{let a=m.value;return a<40?"#e74c3c":a<70?"#f39c12":"#2ecc71"}),_=async()=>{try{let l=await(await fetch("/anon/install/api/token")).json();l.code===200?d.value=l.data.csrf_token:s.value=l.message||"\u83B7\u53D6 Token \u5931\u8D25"}catch(a){s.value="\u7F51\u7EDC\u9519\u8BEF\uFF1A"+a.message}},h=async a=>{if(!t.value){s.value="",t.value=!0;try{let v=await(await fetch("/anon/install/api/mode",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csrf_token:d.value,app_mode:a})})).json();v.code===200?(c.value=a,u.value="database",t.value=!1):(s.value=v.message||"\u6A21\u5F0F\u9009\u62E9\u5931\u8D25",t.value=!1)}catch(l){s.value="\u7F51\u7EDC\u9519\u8BEF\uFF1A"+l.message,t.value=!1}}},S=async()=>{if(!t.value){if(!r.value.db_pass){s.value="\u6570\u636E\u5E93\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A";return}s.value="",t.value=!0;try{let l=await(await fetch("/anon/install/api/database",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csrf_token:d.value,...r.value})})).json();l.code===200?(l.data.tables_exist&&l.data.existing_tables?(p.value=l.data.existing_tables,u.value="overwrite"):c.value==="cms"?u.value="site":u.value="admin",t.value=!1):(s.value=l.message||"\u6570\u636E\u5E93\u914D\u7F6E\u5931\u8D25",t.value=!1)}catch(a){s.value="\u7F51\u7EDC\u9519\u8BEF\uFF1A"+a.message,t.value=!1}}},E=async()=>{if(!t.value){if(n.value.password.length<8){s.value="\u5BC6\u7801\u957F\u5EA6\u81F3\u5C11\u9700\u89818\u4E2A\u5B57\u7B26";return}if(!n.value.email.includes("@")){s.value="\u8BF7\u8F93\u5165\u6709\u6548\u7684\u90AE\u7BB1\u5730\u5740";return}s.value="",t.value=!0;try{let l=await(await fetch("/anon/install/api/site",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csrf_token:d.value,...n.value})})).json();l.code===200?(i.value=l.message||"\u5B89\u88C5\u6210\u529F\uFF01",setTimeout(()=>{window.location.href=l.data.redirect||"/"},1e3)):(s.value=l.message||"\u5B89\u88C5\u5931\u8D25",t.value=!1)}catch(a){s.value="\u7F51\u7EDC\u9519\u8BEF\uFF1A"+a.message,t.value=!1}}},T=async()=>{if(!t.value){if(n.value.password.length<8){s.value="\u5BC6\u7801\u957F\u5EA6\u81F3\u5C11\u9700\u89818\u4E2A\u5B57\u7B26";return}if(!n.value.email.includes("@")){s.value="\u8BF7\u8F93\u5165\u6709\u6548\u7684\u90AE\u7BB1\u5730\u5740";return}s.value="",t.value=!0;try{let l=await(await fetch("/anon/install/api/install",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csrf_token:d.value,username:n.value.username,password:n.value.password,email:n.value.email})})).json();l.code===200?(i.value=l.message||"\u5B89\u88C5\u6210\u529F\uFF01",setTimeout(()=>{window.location.href=l.data.redirect||"/"},1e3)):(s.value=l.message||"\u5B89\u88C5\u5931\u8D25",t.value=!1)}catch(a){s.value="\u7F51\u7EDC\u9519\u8BEF\uFF1A"+a.message,t.value=!1}}},y=async a=>{if(!t.value){s.value="",t.value=!0;try{let v=await(await fetch("/anon/install/api/confirm-overwrite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csrf_token:d.value,confirm:a?"yes":"no"})})).json();v.code===200?(a?c.value==="cms"?u.value="site":u.value="admin":u.value="database",t.value=!1):(s.value=v.message||"\u786E\u8BA4\u5931\u8D25",t.value=!1)}catch(l){s.value="\u7F51\u7EDC\u9519\u8BEF\uFF1A"+l.message,t.value=!1}}},b=()=>{u.value==="database"?u.value="mode":u.value==="overwrite"?u.value="database":(u.value==="site"||u.value==="admin")&&(p.value.length>0?u.value="overwrite":u.value="database"),s.value="",i.value=""},w=()=>e("div",{class:"install-container"},[e("div",{class:"install-header"},[e("h1","\u7CFB\u7EDF\u5B89\u88C5\u5411\u5BFC"),e("p","\u9009\u62E9\u5B89\u88C5\u6A21\u5F0F")]),s.value?e("div",{class:"error"},s.value):null,i.value?e("div",{class:"success"},i.value):null,e("form",{onSubmit:a=>{a.preventDefault()}},[e("div",{class:"form-group"},[e("label","\u5B89\u88C5\u6A21\u5F0F"),e("select",{value:"api",onChange:a=>{let l=a.target;h(l.value)},disabled:t.value},[e("option",{value:"api"},"API \u6A21\u5F0F"),e("option",{value:"cms"},"CMS \u6A21\u5F0F")]),e("div",{class:"requirements"},["API \u6A21\u5F0F\uFF1A\u7EAF API \u63A5\u53E3\uFF0C\u4E0D\u52A0\u8F7D\u4E3B\u9898\u7CFB\u7EDF",e("br"),"CMS \u6A21\u5F0F\uFF1A\u5185\u5BB9\u7BA1\u7406\u7CFB\u7EDF\uFF0C\u652F\u6301\u4E3B\u9898\u548C\u9875\u9762"])]),e("button",{type:"button",class:"btn",onClick:()=>{let a=document.querySelector("select");a&&h(a.value)},disabled:t.value},t.value?"\u5904\u7406\u4E2D...":"\u4E0B\u4E00\u6B65")])]),I=()=>e("div",{class:"install-container"},[e("div",{class:"install-header"},[e("h1","\u7CFB\u7EDF\u5B89\u88C5\u5411\u5BFC"),e("p","\u914D\u7F6E\u6570\u636E\u5E93")]),s.value?e("div",{class:"error"},s.value):null,i.value?e("div",{class:"success"},i.value):null,e("form",{onSubmit:a=>{a.preventDefault(),S()}},[e("h3","\u6570\u636E\u5E93\u914D\u7F6E"),e("div",{class:"form-group"},[e("label","\u6570\u636E\u5E93\u4E3B\u673A"),e("input",{type:"text",value:r.value.db_host,onInput:a=>{r.value.db_host=a.target.value},required:!0,disabled:t.value,placeholder:"localhost"})]),e("div",{class:"form-group"},[e("label","\u6570\u636E\u5E93\u7AEF\u53E3"),e("input",{type:"number",value:r.value.db_port,onInput:a=>{r.value.db_port=parseInt(a.target.value)||3306},min:1,max:65535,required:!0,disabled:t.value,placeholder:"3306"})]),e("div",{class:"form-group"},[e("label","\u6570\u636E\u5E93\u7528\u6237\u540D"),e("input",{type:"text",value:r.value.db_user,onInput:a=>{r.value.db_user=a.target.value},required:!0,disabled:t.value,placeholder:"root"})]),e("div",{class:"form-group"},[e("label","\u6570\u636E\u5E93\u5BC6\u7801"),e("input",{type:"password",value:r.value.db_pass,onInput:a=>{r.value.db_pass=a.target.value},required:!0,disabled:t.value,placeholder:"\u6570\u636E\u5E93\u5BC6\u7801"})]),e("div",{class:"form-group"},[e("label","\u6570\u636E\u5E93\u540D\u79F0"),e("input",{type:"text",value:r.value.db_name,onInput:a=>{r.value.db_name=a.target.value},required:!0,disabled:t.value,placeholder:"\u6570\u636E\u5E93\u540D\u79F0"})]),e("div",{class:"form-group"},[e("label","\u6570\u636E\u8868\u524D\u7F00"),e("input",{type:"text",value:r.value.db_prefix,onInput:a=>{r.value.db_prefix=a.target.value},pattern:"[a-zA-Z0-9_]+",required:!0,disabled:t.value,placeholder:"anon_"}),e("div",{class:"requirements"},"\u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u548C\u4E0B\u5212\u7EBF")]),e("div",{style:"display: flex; gap: 10px;"},[e("button",{type:"button",onClick:b,disabled:t.value,class:"btn",style:"background: #95a5a6; flex: 1;"},t.value?"\u5904\u7406\u4E2D...":"\u8FD4\u56DE\u4E0A\u4E00\u6B65"),e("button",{type:"submit",disabled:t.value,class:"btn",style:"flex: 2;"},t.value?"\u914D\u7F6E\u4E2D...":"\u4E0B\u4E00\u6B65")])])]),k=()=>e("div",{class:"install-container"},[e("div",{class:"install-header"},[e("h1","\u7CFB\u7EDF\u5B89\u88C5\u5411\u5BFC"),e("p","\u914D\u7F6E\u7AD9\u70B9\u4FE1\u606F")]),s.value?e("div",{class:"error"},s.value):null,i.value?e("div",{class:"success"},i.value):null,e("form",{onSubmit:a=>{a.preventDefault(),E()}},[e("h3","\u7BA1\u7406\u5458\u8D26\u53F7"),e("div",{class:"form-group"},[e("label","\u7528\u6237\u540D"),e("input",{type:"text",value:n.value.username,onInput:a=>{n.value.username=a.target.value},required:!0,disabled:t.value,placeholder:"admin"})]),e("div",{class:"form-group"},[e("label","\u90AE\u7BB1"),e("input",{type:"email",value:n.value.email,onInput:a=>{n.value.email=a.target.value},required:!0,disabled:t.value,placeholder:"admin@example.com"})]),e("div",{class:"form-group"},[e("label","\u5BC6\u7801"),e("input",{type:"password",value:n.value.password,onInput:a=>{n.value.password=a.target.value},required:!0,minLength:8,disabled:t.value,placeholder:"\u81F3\u5C118\u4E2A\u5B57\u7B26"}),e("div",{class:"password-strength"},[e("div",{class:"password-strength-bar",style:{width:m.value+"%",backgroundColor:g.value}})]),e("div",{class:"requirements"},"\u81F3\u5C118\u4E2A\u5B57\u7B26\uFF0C\u5EFA\u8BAE\u5305\u542B\u5927\u5C0F\u5199\u5B57\u6BCD\u3001\u6570\u5B57\u548C\u7B26\u53F7")]),e("h3","\u7AD9\u70B9\u4FE1\u606F"),e("div",{class:"form-group"},[e("label","\u7F51\u7AD9\u6807\u9898"),e("input",{type:"text",value:n.value.site_title,onInput:a=>{n.value.site_title=a.target.value},required:!0,disabled:t.value,placeholder:"\u7F51\u7AD9\u6807\u9898"})]),e("div",{class:"form-group"},[e("label","\u7F51\u7AD9\u4ECB\u7ECD"),e("textarea",{value:n.value.site_description,onInput:a=>{n.value.site_description=a.target.value},disabled:t.value,placeholder:"\u7F51\u7AD9\u4ECB\u7ECD",rows:4,style:"width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; font-family: inherit;"})]),e("div",{style:"display: flex; gap: 10px;"},[e("button",{type:"button",onClick:b,disabled:t.value,class:"btn",style:"background: #95a5a6; flex: 1;"},t.value?"\u5904\u7406\u4E2D...":"\u8FD4\u56DE\u4E0A\u4E00\u6B65"),e("button",{type:"submit",disabled:t.value,class:"btn",style:"flex: 2;"},t.value?"\u5B89\u88C5\u4E2D...":"\u5F00\u59CB\u5B89\u88C5")])])]),M=()=>e("div",{class:"install-container"},[e("div",{class:"install-header"},[e("h1","\u7CFB\u7EDF\u5B89\u88C5\u5411\u5BFC"),e("p","\u521B\u5EFA\u7BA1\u7406\u5458\u8D26\u53F7")]),s.value?e("div",{class:"error"},s.value):null,i.value?e("div",{class:"success"},i.value):null,e("form",{onSubmit:a=>{a.preventDefault(),T()}},[e("h3","\u7BA1\u7406\u5458\u8D26\u53F7"),e("div",{class:"form-group"},[e("label","\u7528\u6237\u540D"),e("input",{type:"text",value:n.value.username,onInput:a=>{n.value.username=a.target.value},required:!0,disabled:t.value,placeholder:"admin"})]),e("div",{class:"form-group"},[e("label","\u90AE\u7BB1"),e("input",{type:"email",value:n.value.email,onInput:a=>{n.value.email=a.target.value},required:!0,disabled:t.value,placeholder:"admin@example.com"})]),e("div",{class:"form-group"},[e("label","\u5BC6\u7801"),e("input",{type:"password",value:n.value.password,onInput:a=>{n.value.password=a.target.value},required:!0,minLength:8,disabled:t.value,placeholder:"\u81F3\u5C118\u4E2A\u5B57\u7B26"}),e("div",{class:"password-strength"},[e("div",{class:"password-strength-bar",style:{width:m.value+"%",backgroundColor:g.value}})]),e("div",{class:"requirements"},"\u81F3\u5C118\u4E2A\u5B57\u7B26\uFF0C\u5EFA\u8BAE\u5305\u542B\u5927\u5C0F\u5199\u5B57\u6BCD\u3001\u6570\u5B57\u548C\u7B26\u53F7")]),e("div",{style:"display: flex; gap: 10px;"},[e("button",{type:"button",onClick:b,disabled:t.value,class:"btn",style:"background: #95a5a6; flex: 1;"},t.value?"\u5904\u7406\u4E2D...":"\u8FD4\u56DE\u4E0A\u4E00\u6B65"),e("button",{type:"submit",disabled:t.value,class:"btn",style:"flex: 2;"},t.value?"\u5B89\u88C5\u4E2D...":"\u5F00\u59CB\u5B89\u88C5")])])]),q=async()=>{try{let l=await(await fetch("/anon/install/api/get-mode")).json();l.code===200&&l.data.mode&&(c.value=l.data.mode,u.value="database")}catch{}};x(()=>{_(),q()});let A=()=>e("div",{class:"install-container"},[e("div",{class:"install-header"},[e("h1","\u7CFB\u7EDF\u5B89\u88C5\u5411\u5BFC"),e("p","\u68C0\u6D4B\u5230\u5DF2\u5B58\u5728\u7684\u8868")]),s.value?e("div",{class:"error"},s.value):null,e("div",{class:"form-group"},[e("p",{style:"color: #e74c3c; margin-bottom: 15px;"},"\u8B66\u544A\uFF1A\u68C0\u6D4B\u5230\u4EE5\u4E0B\u8868\u5DF2\u5B58\u5728\u4E8E\u6570\u636E\u5E93\u4E2D\uFF1A"),e("ul",{style:"list-style: none; padding: 0; margin: 0 0 20px 0;"},p.value.map(a=>e("li",{style:"padding: 8px; background: #f8f9fa; margin-bottom: 5px; border-radius: 4px;"},a))),e("p",{style:"color: #e74c3c; margin-bottom: 20px;"},"\u5982\u679C\u7EE7\u7EED\u5B89\u88C5\uFF0C\u8FD9\u4E9B\u8868\u5C06\u88AB\u5220\u9664\u5E76\u91CD\u65B0\u521B\u5EFA\uFF0C\u6240\u6709\u6570\u636E\u5C06\u4E22\u5931\uFF01")]),e("div",{style:"display: flex; gap: 10px;"},[e("button",{type:"button",onClick:()=>y(!1),disabled:t.value,class:"btn",style:"background: #95a5a6; flex: 1;"},"\u53D6\u6D88"),e("button",{type:"button",onClick:()=>y(!0),disabled:t.value,class:"btn",style:"background: #e74c3c; flex: 1;"},t.value?"\u5904\u7406\u4E2D...":"\u786E\u8BA4\u8986\u76D6\u5B89\u88C5")])]);return()=>u.value==="mode"?w():u.value==="database"?I():u.value==="overwrite"?A():u.value==="site"?k():u.value==="admin"?M():w()}};})();
